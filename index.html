<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Marble Project - NYC Education Accountability</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="main-nav">
        <!-- Work in Progress Notice -->
        <div class="wip-notice">
            <a href="https://docs.google.com/forms/d/e/1FAIpQLScAkdWwb5M4gA_zi_zLQeedDLLt4LwB3On5MxiVHobozIDWSw/viewform" target="_blank" rel="noopener noreferrer" class="wip-link">Site Work in Progress [CLICK HERE, JOIN THE PROJECT]</a>
        </div>
        <div class="nav-container">
            <div class="nav-logo">
                <svg width="40" height="40" viewBox="0 0 100 100" class="pillar-icon">
                    <rect x="10" y="5" width="80" height="8" fill="currentColor"/>
                    <rect x="20" y="13" width="15" height="70" fill="currentColor"/>
                    <rect x="42.5" y="13" width="15" height="70" fill="currentColor"/>
                    <rect x="65" y="13" width="15" height="70" fill="currentColor"/>
                    <rect x="10" y="87" width="80" height="8" fill="currentColor"/>
                </svg>
                <span class="logo-text">THE MARBLE PROJECT</span>
            </div>
            <div class="nav-right">
                <button class="nav-toggle" id="navToggle" aria-expanded="false" aria-controls="primaryNav" aria-label="Toggle navigation">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <div class="nav-links" id="primaryNav">
                    <a href="#overview" class="nav-link active">Overview</a>
                    <a href="#spending" class="nav-link">Spending Analysis</a>
                    <a href="#data-table" class="nav-link">Data</a>
                    <a href="#insights" class="nav-link">Insights</a>
                    <button id="darkModeToggle" class="night-mode-btn" title="Toggle dark mode">
                        <svg class="moon-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                        <svg class="sun-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Budget Slideshow Section -->
    <section class="budget-slideshow">
        <div class="slideshow-container">
            <!-- Slide 1: USA Map with NYC Budget -->
            <div class="slide active" data-slide="1">
                <div class="slide-content">
                    <div class="slide-visual">
                        <svg class="usa-map" viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg">
                            <!-- Simple USA outline inspired by provided reference -->
                            <path d="M70 280 L110 240 L170 220 L220 210 L270 195 L320 198 L360 210 L410 225 L470 228 L520 220 L560 220 L610 235 L660 260 L700 300 L690 340 L650 360 L600 368 L550 362 L500 356 L455 350 L410 344 L360 350 L305 352 L250 340 L200 320 L150 300 L110 290 Z" fill="#e5e7eb" stroke="#9ca3af" stroke-width="3" stroke-linejoin="round" stroke-linecap="round"/>
                            <!-- NYC Highlight -->
                            <circle class="nyc-marker pulse" cx="642" cy="242" r="12" fill="#ef4444"/>
                            <text x="662" y="238" font-size="14" font-weight="bold" fill="currentColor">NYC</text>
                        </svg>
                    </div>
                    <div class="slide-text">
                        <h2 class="slide-title">New York City: The Nation's Largest City Budget</h2>
                        <p class="slide-stat">$<span class="stat-number">112.4</span> Billion</p>
                        <p class="slide-description">NYC's annual budget is the largest of any city in the United States</p>
                    </div>
                </div>
            </div>

            <!-- Slide 2: NYC Zoom with DOE Budget -->
            <div class="slide" data-slide="2">
                <div class="slide-content">
                    <div class="slide-visual">
                        <svg class="nyc-map" viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg">
                            <g class="boroughs">
                                <path class="borough staten" d="M210 340 L250 325 L270 330 L265 355 L230 365 Z" />
                                <path class="borough brooklyn" d="M280 310 L330 300 L360 310 L380 350 L340 365 L290 350 Z" />
                                <path class="borough queens" d="M360 250 L410 230 L460 240 L500 270 L470 320 L410 315 L380 285 Z" />
                                <path class="borough manhattan" d="M320 210 L350 190 L370 200 L360 250 L330 260 Z" />
                                <path class="borough bronx" d="M370 170 L410 150 L450 170 L430 210 L390 210 Z" />
                            </g>
                            <!-- School Pinpoints across all boroughs -->
                            <circle class="school-pin" cx="335" cy="245" r="7" />
                            <circle class="school-pin" cx="365" cy="285" r="7" />
                            <circle class="school-pin" cx="305" cy="325" r="7" />
                            <circle class="school-pin" cx="430" cy="260" r="7" />
                            <circle class="school-pin" cx="455" cy="295" r="7" />
                            <circle class="school-pin" cx="390" cy="200" r="7" />
                        </svg>
                    </div>
                    <div class="slide-text">
                        <h2 class="slide-title">Department of Education's Share</h2>
                        <p class="slide-stat">$<span class="stat-number">38.3</span> Billion</p>
                        <p class="slide-description">The DOE receives approximately <strong>1/3</strong> of NYC's entire annual budget</p>
                        <p class="slide-note">Operating 1,600+ schools across all five boroughs</p>
                    </div>
                </div>
            </div>

            <!-- Slide 3: Per-Student Spending -->
            <div class="slide" data-slide="3">
                <div class="slide-content">
                    <div class="slide-visual">
                        <svg class="students-visual" viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg">
                            <!-- Student Icons -->
                            <g class="student-group">
                                <g class="student pos-1">
                                    <circle cx="0" cy="0" r="25" fill="var(--c)"/>
                                    <path d="M -15,30 Q 0,35 15,30 L 20,80 L -20,80 Z" fill="var(--c)"/>
                                </g>
                                <g class="student pos-2">
                                    <circle cx="0" cy="0" r="25" fill="var(--c)"/>
                                    <path d="M -15,30 Q 0,35 15,30 L 20,80 L -20,80 Z" fill="var(--c)"/>
                                </g>
                                <g class="student pos-3">
                                    <circle cx="0" cy="0" r="25" fill="var(--c)"/>
                                    <path d="M -15,30 Q 0,35 15,30 L 20,80 L -20,80 Z" fill="var(--c)"/>
                                </g>
                                <g class="student pos-4">
                                    <circle cx="0" cy="0" r="25" fill="var(--c)"/>
                                    <path d="M -15,30 Q 0,35 15,30 L 20,80 L -20,80 Z" fill="var(--c)"/>
                                </g>
                                <g class="student pos-5">
                                    <circle cx="0" cy="0" r="25" fill="var(--c)"/>
                                    <path d="M -15,30 Q 0,35 15,30 L 20,80 L -20,80 Z" fill="var(--c)"/>
                                </g>
                            </g>
                            <!-- Price Tag -->
                            <g class="price-tag" transform="translate(400, 350)">
                                <path d="M -80,0 L 60,0 L 80,20 L 60,40 L -80,40 Z" fill="#ef4444" stroke="#991b1b" stroke-width="2"/>
                                <circle cx="-60" cy="20" r="5" fill="#fff"/>
                                <text x="-40" y="28" font-size="24" font-weight="bold" fill="#fff">$38,000</text>
                            </g>
                        </svg>
                    </div>
                    <div class="slide-text">
                        <h2 class="slide-title">Highest Per-Student Spending in America</h2>
                        <p class="slide-stat">$<span class="stat-number">38,000</span></p>
                        <p class="slide-description">NYC spends more per student than any other major city in the nation</p>
                        <p class="slide-note">Serving approximately 1 million students</p>
                    </div>
                </div>
            </div>

            <!-- Slide 4: CTA -->
            <div class="slide" data-slide="4">
                <div class="slide-content">
                    <div class="slide-visual">
                        <svg class="cta-visual" viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg">
                            <rect x="180" y="120" width="440" height="260" rx="18" fill="#0ea5e9" opacity="0.12" stroke="#0284c7" stroke-width="3" />
                            <path d="M260 200 L400 320 L540 200" fill="none" stroke="#0284c7" stroke-width="10" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="400" cy="320" r="12" fill="#f43f5e"/>
                            <text x="400" y="360" text-anchor="middle" font-size="20" font-weight="700" fill="#0284c7">Scroll Down</text>
                        </svg>
                    </div>
                    <div class="slide-text">
                        <h2 class="slide-title">Now scroll down</h2>
                        <p class="slide-stat">Explore the details</p>
                        <p class="slide-description">See what the DOE has been doing with <strong>your</strong> money over the last three fiscal years.</p>
                        <p class="slide-note">Dive into the data, trends, and biggest overruns below.</p>
                    </div>
                </div>
            </div>

            <!-- Slide Indicators -->
            <div class="slide-indicators">
                <button class="indicator active" data-slide="1" title="Slide 1: NYC budget" aria-label="Slide 1: NYC budget"></button>
                <button class="indicator" data-slide="2" title="Slide 2: DOE share" aria-label="Slide 2: DOE share"></button>
                <button class="indicator" data-slide="3" title="Slide 3: Per-student spending" aria-label="Slide 3: Per-student spending"></button>
                <button class="indicator" data-slide="4" title="Slide 4: Scroll to data" aria-label="Slide 4: Scroll to data"></button>
            </div>

            <!-- Navigation Arrows -->
            <button class="slide-nav prev" aria-label="Previous slide">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
            </button>
            <button class="slide-nav next" aria-label="Next slide">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
            </button>
        </div>
    </section>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h1 class="hero-title fade-in">NYC Education Budget Accountability</h1>
            <p class="hero-subtitle fade-in delay-1">Forensic analysis of Department of Education spending across 43,249 budget records from 2023-2025</p>
            <div class="hero-stats fade-in delay-2">
                <div class="hero-stat">
                    <div class="stat-value" id="heroTotal">$0</div>
                    <div class="stat-label">Total Spending</div>
                </div>
                <div class="hero-stat">
                    <div class="stat-value" id="heroPrograms">0</div>
                    <div class="stat-label">Programs Tracked</div>
                </div>
                <div class="hero-stat">
                    <div class="stat-value" id="heroAlerts">0</div>
                    <div class="stat-label">Budget Alerts</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Overview Section -->
        <section id="overview" class="section">
            <div class="section-header">
                <h2>Spending Overview</h2>
                <p>Comprehensive analysis of education budget allocations and expenditures</p>
            </div>
            
            <div class="metrics-grid">
                <div class="metric-card slide-up">
                    <div class="metric-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"></line>
                            <line x1="12" y1="20" x2="12" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="14"></line>
                        </svg>
                    </div>
                    <div class="metric-content">
                        <div class="metric-value" id="totalSpent">Loading...</div>
                        <div class="metric-label">Total Spent</div>
                    </div>
                </div>
                <div class="metric-card slide-up delay-1">
                    <div class="metric-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="7" width="20" height="14" rx="0"></rect>
                            <path d="M16 7V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"></path>
                        </svg>
                    </div>
                    <div class="metric-content">
                        <div class="metric-value" id="totalBudget">$0</div>
                        <div class="metric-label">Working Budget</div>

                    </div>
                </div>
                <div class="metric-card alert slide-up delay-3">
                    <div class="metric-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                            <line x1="12" y1="9" x2="12" y2="13"></line>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            <circle cx="12" cy="19" r="1.4" fill="currentColor" stroke="currentColor"></circle>
                        </svg>
                    </div>
                    <div class="metric-content">
                        <div class="metric-value" id="overBudget">0</div>
                        <div class="metric-label">Over Budget</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Visualization Section -->
        <section id="spending" class="section">
            <div class="section-header">
                <h2>Spending Analysis</h2>
                <div class="filter-controls">
                    <select id="yearFilter" class="filter-select" title="Filter by year">
                        <option value="all">All Years</option>
                        <option value="2023">2023</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                    </select>
                    <input type="text" id="searchBox" class="search-input" placeholder="Search departments, programs...">
                </div>
            </div>

            <div class="charts-container">
                <div class="chart-card large">
                    <div class="chart-header">
                        <h3>Spending by Department</h3>
                        <select id="chartView" class="chart-toggle" title="Toggle chart view">
                            <option value="bar">Bar Chart</option>
                            <option value="pie">Pie Chart</option>
                        </select>
                    </div>
                    <canvas id="departmentChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Worst Offenders Section -->
        <section id="offenders" class="section">
            <div class="section-header">
                <h2>Top 5 Worst Offenders</h2>
                <p>Programs with the most significant budget overruns</p>
            </div>
            <div class="offenders-slider-container">
                <div class="offenders-slider" id="offendersSlider">
                    <!-- Offender cards will be injected here by app.js -->
                </div>
                <button class="slider-btn prev" id="sliderPrev">‹</button>
                <button class="slider-btn next" id="sliderNext">›</button>
            </div>
        </section>

        <!-- Data Table Section -->
        <section id="data-table" class="section">
            <div class="section-header">
                <h2>Budget Details</h2>
                <div class="table-controls">
                    <input type="text" id="tableSearch" class="search-input table-search" placeholder="Search in table...">
                    <select id="programFilter" class="filter-select" title="Filter by program">
                        <option value="all">All Programs</option>
                    </select>
                    <select id="tableYearFilter" class="filter-select" title="Filter by year">
                        <option value="all">All Years</option>
                        <option value="2023">2023</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                    </select>
                    <select id="departmentFilter" class="filter-select" title="Filter by department">
                        <option value="all">All Departments</option>
                    </select>
                    <button class="btn-secondary" id="exportData">Export CSV</button>
                </div>
            </div>

            <div id="exportModal" class="export-modal hidden" role="dialog" aria-modal="true" aria-labelledby="exportModalTitle">
                <div class="export-modal__backdrop"></div>
                <div class="export-modal__content">
                    <h3 id="exportModalTitle">Export CSV</h3>
                    <p>Select which rows to export.</p>
                    <div class="export-modal__actions">
                        <button class="btn-secondary" id="exportPageBtn">Current page only</button>
                        <button class="btn-secondary" id="exportAllBtn">All filtered rows</button>
                        <button class="btn-alert" id="exportCancelBtn">Cancel</button>
                    </div>
                </div>
            </div>
            <div class="table-scroll-top" aria-hidden="true">
                <div class="table-scroll-spacer"></div>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th data-sort="Year" class="sortable">Year ↕</th>
                            <th data-sort="Department" class="sortable">Department ↕</th>
                            <th data-sort="Budget Name" class="sortable">Program ↕</th>
                            <th data-sort="Modified" class="sortable">Budget ↕</th>
                            <th data-sort="Cash Expense" class="sortable">Spent ↕</th>
                            <th data-sort="Difference" class="sortable">Difference ↕</th>
                            <th data-sort="Status" class="sortable">Status ↕</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <tr><td colspan="7" class="loading-cell">Loading data...</td></tr>
                    </tbody>
                </table>
                <div class="table-footer">
                    <span id="recordCount">Showing 0 records</span>
                    <div class="pagination">
                        <button id="prevPage" class="page-btn">Previous</button>
                        <span id="pageInfo">Page 1</span>
                        <button id="nextPage" class="page-btn">Next</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Insights Section -->
        <section id="insights" class="section">
            <div class="section-header">
                <h2>Key Findings</h2>
                <p>Automated analysis of spending patterns and anomalies</p>
            </div>

            <div class="insights-grid" id="insightsContainer">
                <div class="loading-cell">Analyzing data...</div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>The Marble Project</h4>
                <p>Making Accountability Real Before it Leaves the Executive</p>
            </div>
            <div class="footer-section">
                <h4>Data Source</h4>
                <p>NYC Open Data - Department of Education</p>
                <p class="data-note">43,249 records spanning 2023-2025</p>
            </div>
            <div class="footer-section" id="authors">
                <h4>About</h4>
                <p>Independent budget analysis tool</p>
                <p class="authors">Presented by <strong>Ambrose Sukraj</strong> & <strong>Aftid Rahman</strong></p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 The Marble Project. Data accuracy subject to NYC reporting standards.</p>
            <p class="footnote">*Working Budget includes in-year adjustments and transfers</p>
        </div>
    </footer>

    <script src="app.js"></script>
</body>
</html>